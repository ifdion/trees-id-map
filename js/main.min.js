"use strict";jQuery(document).ready(function(){function a(b,c,d,e,f){console.log(f),z.send(b,{onSuccess:function(j){j.data.forEach(function(a){if(a.kordinat_center){var b=parseFloat(a.kordinat_center.lat),e=parseFloat(a.kordinat_center.lng);c.push([b,e,a.id_lot]),h[0]+=b,h[1]+=e}d[a.id_lot]=a});var l=c.length/j.totalCount*100,p=Math.ceil(j.totalCount/m);if(console.log(l.toFixed(2)+" percent "),2>e){var r=_.map(h,function(a){return a/c.length});window.map=new L.Map("trees-id-map",{center:r,zoom:o,layers:[y]}),window.heat=L.heatLayer(c,q).addTo(window.map)}else window.heat.setLatLngs(c);p>1&&p>e?(e++,b=-1===b.indexOf("&page=")?b+"&page="+e:b.replace(/&page=?\d+$/g,"&page="+e),a(b,c,d,e,f)):window.map.on("zoomend dragend",function(){var a=window.map.getZoom();if(a>=n){var b=window.map.getBounds(),d=b.getWest(),e=b.getSouth(),h=b.getEast(),j=b.getNorth(),l=_.filter(c,function(a){return a[1]>d-.005&&a[1]<h+.005&&a[0]<j+.005&&a[0]>e-.005});l.length>0&&l.forEach(function(a){if(-1===i.indexOf(a)){i.push(a);var b=f.replace("[lot]",g[a[2]].id_lot),c='<a class="popup-link text-center" href="'+b+'"><img id="popup-image" class="popup-image" src="'+g[a[2]].img_lot+'" width="200" ></div><br> <span>'+g[a[2]].nama_lot+"</span></a>";k[a[2]]=L.polygon(g[a[2]].kordinat,{color:t,weight:u,fillColor:v,fillOpacity:w}).bindPopup(c),k[a[2]].addTo(window.map)}});var m=_.difference(i,l);m.forEach(function(a){var b=i.indexOf(a);i.splice(b,1),window.map.removeLayer(k[a[2]])}),window.map.removeLayer(window.heat)}else window.heat.addTo(window.map),k.forEach(function(a){window.map.removeLayer(a)}),i=[]})}})}function b(a,b){var c="http://api.trees.id/?object=lot&callback=callback&content=map&id="+a;z.send(c,{onSuccess:function(c){if(void 0!==c.data)window.map=new L.Map("trees-id-map",{center:c.mapCenter,zoom:n,layers:[y]}),window.heat=L.heatLayer(c.data,q).addTo(window.map),window.map.on("zoomend dragend",function(){var d=window.map.getZoom();if(d>=p){var e=window.map.getBounds(),f=e.getWest(),g=e.getSouth(),h=e.getEast(),i=e.getNorth(),k=_.filter(c.data,function(a){return a[1]>f-5e-5&&a[1]<h+5e-5&&a[0]<i+5e-5&&a[0]>g-5e-5});k.length>0&&k.forEach(function(d){if(-1===j.indexOf(d)){j.push(d);var e=b.replace("[lot]",a).replace("[offset]",parseInt(d[2])),f='<a href="'+e+'"><img src="'+r+c.id_relawan+"/"+a+"/"+d[2]+'" width="200"></a>';l[d[2]]=L.marker([d[0],d[1]],{icon:x}).addTo(window.map).bindPopup(f)}});var m=_.difference(j,k);m.forEach(function(a){var b=j.indexOf(a);j.splice(b,1),window.map.removeLayer(l[a[2]])}),window.map.removeLayer(window.heat)}else window.heat.addTo(window.map),j.forEach(function(a){window.map.removeLayer(l[a[2]])}),j=[]});else{var d=[];c.polygon.forEach(function(a){var b=L.latLng(a[0],a[1]);d.push(b)}),window.map=new L.Map("trees-id-map",{center:c.center,zoom:n,layers:[y]}),window.lotPolygon=L.polygon(d,{color:t,weight:u,fillColor:v,fillOpacity:w}),window.lotPolygon.addTo(window.map)}},onTimeout:function(){console.log("timeout!")}})}function c(a){console.log("Rendering Single Tree ",a);var b="http://api.trees.id/?object=tree&callback=callback&single_id="+a;z.send(b,{onSuccess:function(a){console.log(a),window.map=new L.Map("trees-id-map",{center:a.data[0].tree_kordinat,zoom:p,layers:[y]});{var b='<img src="'+a.data[0].img_tree+'" width="200">';L.marker(a.data[0].tree_kordinat,{icon:x}).addTo(window.map).bindPopup(b).openPopup()}},onTimeout:function(){console.log("timeout!")}})}function d(a,b){var c="http://api.trees.id/?object=tree&callback=callback&lot_id="+a+"&tree_offset="+b;z.send(c,{onSuccess:function(a){window.map=new L.Map("trees-id-map",{center:a.data[0].tree_kordinat,zoom:p,layers:[y],scrollWheelZoom:!1});{var b='<img src="'+a.data[0].img_tree+'" width="200">';L.marker(a.data[0].tree_kordinat,{icon:x}).addTo(window.map).bindPopup(b)}},onTimeout:function(){console.log("timeout!")}})}function e(){var e;if(e=A.getAttribute("data-map-type"),"tree"==e){var h=A.getAttribute("data-id");if("null"!=h)console.log("treeID",h),c(h);else{var i=A.getAttribute("data-lot_id"),j=A.getAttribute("data-offset");console.log("lotIDTree :"+i+" | offset_tree :"+j),d(i,j)}}else{var k=A.getAttribute("data-id");if(k){var l=A.getAttribute("data-tree-page");b(k,l)}else{var n="http://api.trees.id/?object=lot&per_page="+m+"&callback=callback",o=[],p=A.getAttribute("data-lot-page");s.forEach(function(a){var b=A.getAttribute("data-"+a);b&&(o[a]=b,n=n+"&"+a+"="+b)}),a(n,f,g,1,p)}}}var f=[],g=[],h=[0,0],i=[],j=[],k=[],l=[],m=20,n=17,o=7,p=22,q={radius:10,blur:10,maxZoom:11,gradient:{.4:"lime",.65:"green",1:"darkgreen"}},r="http://api.trees.id/tree/",s=["program_id","project_id","block_id","relawan_id","verifikator_id","petani_id","status"],t="lime",u=2,v="darkgreen",w=.5,x=L.icon({iconUrl:"http://api.trees.id/tree.png",iconSize:[16,16],iconAnchor:[0,8],popupAnchor:[8,-8]}),y=L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",maxZoom:27,maxNativeZoom:17}),z=function(){var a={};return a.send=function(a,b){var c=b.callbackName||"callback",d=b.onSuccess||function(){},e=b.onTimeout||function(){},f=b.timeout||20,g=window.setTimeout(function(){window[c]=function(){},e()},1e3*f);window[c]=function(a){window.clearTimeout(g),d(a)};var h=document.createElement("script");h.type="text/javascript",h.async=!0,h.src=a,document.getElementsByTagName("head")[0].appendChild(h)},a}(),A=document.getElementById("trees-id-map");A&&e()});