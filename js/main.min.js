"use strict";jQuery(document).ready(function(a){function b(a,c,d,e,f){console.log(f),D.send(a,{onSuccess:function(g){g.data.forEach(function(a,b,e){if(a.kordinat_center){var f=parseFloat(a.kordinat_center.lat),g=parseFloat(a.kordinat_center.lng);c.push([f,g,a.id_lot]),i[0]+=f,i[1]+=g}d[a.id_lot]=a});var j=c.length/g.totalCount*100,k=Math.ceil(g.totalCount/q);if(console.log(j.toFixed(2)+" percent "),2>e){var l=_.map(i,function(a){return a/c.length});window.map=new L.Map("trees-id-map",{center:l,zoom:s,layers:[C]}),window.heat=L.heatLayer(c,u).addTo(window.map)}else window.heat.setLatLngs(c);k>1&&k>e?(e++,a=-1===a.indexOf("&page=")?a+"&page="+e:a.replace(/&page=?\d+$/g,"&page="+e),b(a,c,d,e,f)):window.map.on("zoomend dragend",function(a){var b=window.map.getZoom();if(b>=r){var d=window.map.getBounds(),e=d.getWest(),g=d.getSouth(),i=d.getEast(),j=d.getNorth(),k=_.filter(c,function(a){return a[1]>e-.005&&a[1]<i+.005&&a[0]<j+.005&&a[0]>g-.005});k.length>0&&k.forEach(function(a){if(-1===m.indexOf(a)){m.push(a);var b=f.replace("[lot]",h[a[2]].id_lot),c='<a class="popup-link text-center" href="'+b+'"><img id="popup-image" class="popup-image" src="'+h[a[2]].img_lot+'" width="200" ></div><br> <span>'+h[a[2]].nama_lot+"</span></a>";o[a[2]]=L.polygon(h[a[2]].kordinat,{color:x,weight:y,fillColor:z,fillOpacity:A}).bindPopup(c),o[a[2]].addTo(window.map)}});var l=_.difference(m,k);l.forEach(function(a){var b=m.indexOf(a);m.splice(b,1),window.map.removeLayer(o[a[2]])}),window.map.removeLayer(window.heat)}else window.heat.addTo(window.map),o.forEach(function(a){window.map.removeLayer(a)}),m=[]})}})}function c(a,b){var c="http://api.trees.id/?object=lot&callback=callback&content=map&id="+a;D.send(c,{onSuccess:function(c){if(void 0!==c.data)window.map=new L.Map("trees-id-map",{center:c.mapCenter,zoom:r,layers:[C]}),window.heat=L.heatLayer(c.data,u).addTo(window.map),window.map.on("zoomend dragend",function(d){var e=window.map.getZoom();if(e>=t){var f=window.map.getBounds(),g=f.getWest(),h=f.getSouth(),i=f.getEast(),j=f.getNorth(),k=_.filter(c.data,function(a){return a[1]>g-5e-5&&a[1]<i+5e-5&&a[0]<j+5e-5&&a[0]>h-5e-5});k.length>0&&k.forEach(function(d,e){if(-1===n.indexOf(d)){n.push(d);var f=b.replace("[lot]",a).replace("[offset]",parseInt(d[2])),g='<a href="'+f+'"><img src="'+v+c.id_relawan+"/"+a+"/"+d[2]+'" width="200"></a>';p[d[2]]=L.marker([d[0],d[1]],{icon:B}).addTo(window.map).bindPopup(g)}});var l=_.difference(n,k);l.forEach(function(a){var b=n.indexOf(a);n.splice(b,1),window.map.removeLayer(p[a[2]])}),window.map.removeLayer(window.heat)}else window.heat.addTo(window.map),n.forEach(function(a){window.map.removeLayer(p[a[2]])}),n=[]});else{var d=[];c.polygon.forEach(function(a,b){var c=L.latLng(a[0],a[1]);d.push(c)}),window.map=new L.Map("trees-id-map",{center:c.center,zoom:r,layers:[C]}),window.lotPolygon=L.polygon(d,{color:x,weight:y,fillColor:z,fillOpacity:A}),window.lotPolygon.addTo(window.map)}},onTimeout:function(){console.log("timeout!")}})}function d(a){console.log("Rendering Single Tree ",a);var b="http://api.trees.id/?object=tree&callback=callback&single_id="+a;D.send(b,{onSuccess:function(a){console.log(a),window.map=new L.Map("trees-id-map",{center:a.data[0].tree_kordinat,zoom:t,layers:[C]});{var b='<img src="'+a.data[0].img_tree+'" width="200">';L.marker(a.data[0].tree_kordinat,{icon:B}).addTo(window.map).bindPopup(b).openPopup()}},onTimeout:function(){console.log("timeout!")}})}function e(a,b,c,d,f){console.log(f),D.send(a,{onSuccess:function(g){g.data.forEach(function(a,d,e){if(a.tree_kordinat){var f=parseFloat(a.tree_kordinat[0]),g=parseFloat(a.tree_kordinat[1]);b.push([f,g,a.id_tree]),i[0]+=f,i[1]+=g}c[a.id_tree]=a});var h=b.length/g.totalCount*100,j=Math.ceil(g.totalCount/l);if(console.log(h.toFixed(2)+" percent "),2>d){var m=_.map(i,function(a){return a/b.length});window.map=new L.Map("trees-id-map",{center:m,zoom:s,layers:[C]}),window.heat=L.heatLayer(b,u).addTo(window.map)}else window.heat.setLatLngs(b);j>1&&j>d?(d++,a=-1===a.indexOf("&page=")?a+"&page="+d:a.replace(/&page=?\d+$/g,"&page="+d),e(a,b,c,d,f)):window.map.on("zoomend dragend",function(a){var c=window.map.getZoom();if(c>=10){var d=window.map.getBounds(),e=d.getWest(),g=d.getSouth(),h=d.getEast(),i=d.getNorth(),j=_.filter(b,function(a){return a[1]>e-5e-5&&a[1]<h+5e-5&&a[0]<i+5e-5&&a[0]>g-5e-5});j.length>0&&j.forEach(function(a,b){if(-1===n.indexOf(a)){n.push(a);var c=f.replace("[lot]",k[a[2]].tree_lot_id).replace("[offset]",parseInt(a[2])),d='<a href="'+c+'"><img src="'+k[a[2]].img_tree+'" width="200"></a>';p[a[2]]=L.marker([a[0],a[1]],{icon:B}).addTo(window.map).bindPopup(d)}});var l=_.difference(n,j);l.forEach(function(a){var b=n.indexOf(a);n.splice(b,1),window.map.removeLayer(p[a[2]])}),window.map.removeLayer(window.heat)}else window.heat.addTo(window.map),n.forEach(function(a){window.map.removeLayer(p[a[2]])}),n=[]})}})}function f(){var a;if(a=E.getAttribute("data-map-type"),"tree"==a){var f=E.getAttribute("data-id");console.log("treeID",f),d(f)}else if("archive-tree"==a){console.log("start archive tree");var i="http://api.trees.id/?object=tree&per_page="+l+"&callback=callback",m=[],n=E.getAttribute("data-tree-page");w.forEach(function(a,b){var c=E.getAttribute("data-"+a);c&&(m[a]=c,i=i+"&"+a+"="+c)}),e(i,j,k,1,n)}else{var o=E.getAttribute("data-id");if(o){var n=E.getAttribute("data-tree-page");c(o,n)}else{var i="http://api.trees.id/?object=lot&per_page="+q+"&callback=callback",m=[],p=E.getAttribute("data-lot-page");w.forEach(function(a,b){var c=E.getAttribute("data-"+a);c&&(m[a]=c,i=i+"&"+a+"="+c)}),b(i,g,h,1,p)}}}var g=[],h=[],i=[0,0],j=[],k=[],i=[0,0],l=20,m=[],n=[],o=[],p=[],q=20,r=17,s=7,t=22,u={radius:10,blur:10,maxZoom:11,gradient:{.4:"lime",.65:"green",1:"darkgreen"}},v="http://api.trees.id/tree/",w=["program_id","project_id","block_id","relawan_id","verifikator_id","petani_id","status","nohp"],x="lime",y=2,z="darkgreen",A=.5,B=L.icon({iconUrl:"http://api.trees.id/tree.png",iconSize:[16,16],iconAnchor:[0,8],popupAnchor:[8,-8]}),C=L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",maxZoom:27,maxNativeZoom:17}),D=function(){var a={};return a.send=function(a,b){var c=b.callbackName||"callback",d=b.onSuccess||function(){},e=b.onTimeout||function(){},f=b.timeout||20,g=window.setTimeout(function(){window[c]=function(){},e()},1e3*f);window[c]=function(a){window.clearTimeout(g),d(a)};var h=document.createElement("script");h.type="text/javascript",h.async=!0,h.src=a,document.getElementsByTagName("head")[0].appendChild(h)},a}(),E=document.getElementById("trees-id-map");E&&f()});